@page
@model EnableAuthenticatorModel
@{
    ViewData["Title"] = "Kimlik Doğrulayıcı Ekle";
    ViewData["ActivePage"] = ManageNavPages.TwoFactorAuthentication;
    Layout = "_Layout";
}

<div class="max-w-4xl">
    <div class="mb-6">
        <h3 class="text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2">
            <i class="fas fa-qrcode text-accent-500"></i> @ViewData["Title"]
        </h3>
        <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Bir kimlik doğrulayıcı uygulama (Google/Microsoft Authenticator) kullanarak kurulumu tamamlayın.</p>
    </div>

    <partial name="_StatusMessage" for="StatusMessage" />

    <div class="bg-white dark:bg-petrol-900/50 border border-gray-100 dark:border-petrol-700 rounded-xl p-6 shadow-sm">
        <div class="space-y-8">
            <!-- Adım 1 -->
            <div class="flex items-start">
                <div class="flex-shrink-0 w-8 h-8 rounded-full bg-petrol-100 dark:bg-petrol-800 text-petrol-600 dark:text-petrol-300 flex items-center justify-center font-bold mr-4">1</div>
                <div>
                    <h4 class="font-bold text-gray-900 dark:text-white mb-2">Uygulamayı İndirin</h4>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">Aşağıdaki uygulamalardan birini telefonunuza yükleyin:</p>
                    <div class="flex flex-wrap gap-2">
                        <a href="https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2&amp;hl=en" target="_blank" class="text-xs bg-gray-100 dark:bg-petrol-800 px-3 py-1.5 rounded-lg hover:bg-gray-200 transition-colors inline-flex items-center text-gray-700 dark:text-gray-300">
                            <i class="fab fa-android mr-1 text-green-500"></i> Android (Google)
                        </a>
                        <a href="https://itunes.apple.com/us/app/google-authenticator/id388497605?mt=8" target="_blank" class="text-xs bg-gray-100 dark:bg-petrol-800 px-3 py-1.5 rounded-lg hover:bg-gray-200 transition-colors inline-flex items-center text-gray-700 dark:text-gray-300">
                            <i class="fab fa-apple mr-1 text-gray-500 dark:text-gray-200"></i> iOS (Google)
                        </a>
                    </div>
                </div>
            </div>

            <!-- Adım 2 -->
            <div class="flex items-start">
                <div class="flex-shrink-0 w-8 h-8 rounded-full bg-petrol-100 dark:bg-petrol-800 text-petrol-600 dark:text-petrol-300 flex items-center justify-center font-bold mr-4">2</div>
                <div class="w-full">
                    <h4 class="font-bold text-gray-900 dark:text-white mb-2">QR Kodu Tarayın</h4>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Uygulama içerisinden "Hesap Ekle" diyerek aşağıdaki QR kodu taratın.</p>

                    <div class="bg-white p-4 rounded-xl inline-block border border-gray-200">
                        <div id="qrCode"></div>
                        <div id="qrCodeData" data-url="@Model.AuthenticatorUri"></div>
                    </div>

                    <div class="mt-4 p-4 bg-gray-50 dark:bg-petrol-800/30 rounded-xl border border-gray-200 dark:border-petrol-700">
                        <p class="text-xs text-gray-500 dark:text-gray-400 mb-1">Kameranız çalışmıyorsa bu anahtarı manuel girin:</p>
                        <code class="block bg-gray-100 dark:bg-petrol-900 p-2 rounded text-accent-500 font-mono text-center tracking-widest text-lg select-all">@Model.SharedKey</code>
                    </div>
                </div>
            </div>

            <!-- Adım 3 -->
            <div class="flex items-start">
                <div class="flex-shrink-0 w-8 h-8 rounded-full bg-petrol-100 dark:bg-petrol-800 text-petrol-600 dark:text-petrol-300 flex items-center justify-center font-bold mr-4">3</div>
                <div class="w-full">
                    <h4 class="font-bold text-gray-900 dark:text-white mb-2">Doğrulama Kodunu Girin</h4>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Uygulamanın ürettiği 6 haneli kodu aşağıya girerek kurulumu tamamlayın.</p>

                    <form id="send-code" method="post" class="max-w-xs">
                        <div class="relative group">
                            <input asp-for="Input.Code" class="peer block px-2.5 pb-2.5 pt-5 w-full text-center text-xl tracking-widest font-mono text-gray-900 bg-gray-50/50 dark:bg-petrol-900/50 rounded-xl border border-gray-300 dark:border-petrol-600 appearance-none dark:text-white focus:outline-none focus:ring-0 focus:border-accent-500 focus:bg-white dark:focus:bg-petrol-900 transition-all" placeholder=" " autocomplete="off" />
                            <label asp-for="Input.Code" class="absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-4 scale-75 top-4 z-10 origin-[0] left-1/2 -translate-x-1/2 peer-placeholder-shown:left-1/2 peer-placeholder-shown:-translate-x-1/2 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:top-3.5 peer-focus:scale-75 peer-focus:-translate-y-4 font-medium pointer-events-none">Doğrulama Kodu</label>
                            <span asp-validation-for="Input.Code" class="text-red-500 text-xs mt-1 block text-center font-medium"></span>
                        </div>

                        <button type="submit" class="mt-4 w-full py-3 px-6 bg-gradient-to-r from-accent-500 to-accent-600 text-white rounded-xl font-bold shadow-lg hover:shadow-accent-500/30 hover:-translate-y-0.5 transition-all">
                            Doğrula ve Etkinleştir
                        </button>
                        <div asp-validation-summary="ModelOnly" class="text-red-500 text-sm mt-2 text-center font-bold" role="alert"></div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script src="~/lib/qrcode/qrcode.min.js"></script> <!-- QRCode kütüphanesi gerekli -->
    <script type="text/javascript">
        new QRCode(document.getElementById("qrCode"), {
            text: "@Html.Raw(Model.AuthenticatorUri)",
            width: 150,
            height: 150
        });
    </script>
}